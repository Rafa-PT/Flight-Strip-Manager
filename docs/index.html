<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Flight Radar</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    #map {
      height: 100vh;
    }
    #search-bar {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    input {
      padding: 8px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 300px;
    }
    button {
      padding: 8px 16px;
      font-size: 16px;
      border: none;
      background: #007bff;
      color: white;
      cursor: pointer;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div id="search-bar">
    <input id="flight-search" type="text" placeholder="Search for a flight (e.g., ICAO24 or Callsign)" />
    <button onclick="searchFlight()">Search</button>
  </div>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const API_USERNAME = "your_opensky_username"; // Replace with your OpenSky username
    const API_PASSWORD = "your_opensky_password"; // Replace with your OpenSky password
    const map = L.map('map').setView([20, 0], 3); // Initial map view (global)
    const flightMarkers = new Map(); // Store flight markers by ICAO24

    // Add map tiles (OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: 'Â© OpenStreetMap contributors',
    }).addTo(map);

    // Fetch live flight data
    async function fetchLiveFlights() {
      try {
        const response = await fetch('https://opensky-network.org/api/states/all', {
          headers: {
            Authorization: `Basic ${btoa(API_USERNAME + ":" + API_PASSWORD)}`,
          },
        });
        if (!response.ok) throw new Error("Failed to fetch flight data");
        const data = await response.json();
        updateMap(data.states);
      } catch (error) {
        console.error(error);
        alert("Unable to load live flight data. Check your credentials or API limits.");
      }
    }

    // Update flight markers on the map
    function updateMap(flights) {
      flights.forEach((flight) => {
        const [icao24, callsign, lat, lon, altitude] = flight;
        if (!lat || !lon) return; // Skip flights without position data

        // Check if the marker already exists
        let marker = flightMarkers.get(icao24);
        if (!marker) {
          marker = L.marker([lat, lon]).addTo(map).bindPopup(getPopupContent(icao24, callsign, altitude));
          flightMarkers.set(icao24, marker);
        } else {
          // Update marker position and popup
          marker.setLatLng([lat, lon]);
          marker.setPopupContent(getPopupContent(icao24, callsign, altitude));
        }
      });
    }

    // Generate popup content
    function getPopupContent(icao24, callsign, altitude) {
      return `
        <strong>ICAO24:</strong> ${icao24}<br>
        <strong>Callsign:</strong> ${callsign || "N/A"}<br>
        <strong>Altitude:</strong> ${altitude ? `${altitude} m` : "N/A"}
      `;
    }

    // Search for a flight
    function searchFlight() {
      const query = document.getElementById('flight-search').value.toLowerCase();
      const marker = Array.from(flightMarkers.values()).find((marker) => {
        const content = marker.getPopup().getContent().toLowerCase();
        return content.includes(query);
      });
      if (marker) {
        map.setView(marker.getLatLng(), 8); // Zoom in on the marker
        marker.openPopup();
      } else {
        alert("No matching flight found.");
      }
    }

    // Refresh flight data every 10 seconds
    fetchLiveFlights();
    setInterval(fetchLiveFlights, 10000);
  </script>
</body>
</html>



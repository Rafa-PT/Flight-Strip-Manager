document.addEventListener("DOMContentLoaded", () => {
    // Initialize the map
    const map = L.map('map').setView([51.505, -0.09], 2); // Default position: London
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Form and preview elements
    const flightPlannerForm = document.getElementById('flight-planner-form');
    const flightPlanPreview = document.getElementById('flight-plan-preview');
    const flightPlansTableBody = document.getElementById('flight-plans-table-body');

    // Update Flight Plan Preview
    function updateFlightPlanPreview() {
        document.getElementById('flight-rules-preview').textContent = document.getElementById('flight-rules').value;
        document.getElementById('aircraft-id-preview').textContent = document.getElementById('aircraft-id').value || 'N/A';
        document.getElementById('aircraft-type-preview').textContent = document.getElementById('aircraft-type').value || 'N/A';
        document.getElementById('departure-preview').textContent = document.getElementById('departure').value || 'N/A';
        document.getElementById('destination-preview').textContent = document.getElementById('destination').value || 'N/A';
        document.getElementById('altitude-preview').textContent = document.getElementById('altitude').value || 'N/A';
        document.getElementById('route-preview').textContent = document.getElementById('route').value || 'N/A';
        document.getElementById('ete-preview').textContent = document.getElementById('ete').value || 'N/A';
        document.getElementById('alternate1-preview').textContent = document.getElementById('alternate1').value || 'N/A';
        document.getElementById('alternate2-preview').textContent = document.getElementById('alternate2').value || 'N/A';
        document.getElementById('remarks-preview').textContent = document.getElementById('remarks').value || 'N/A';
    }

    // Submit Flight Plan
    function submitFlightPlan(event) {
        event.preventDefault(); // Prevent form from refreshing the page

        // Retrieve form values
        const flightRules = document.getElementById('flight-rules').value;
        const aircraftId = document.getElementById('aircraft-id').value || 'N/A';
        const aircraftType = document.getElementById('aircraft-type').value || 'N/A';
        const departure = document.getElementById('departure').value || 'N/A';
        const destination = document.getElementById('destination').value || 'N/A';
        const altitude = document.getElementById('altitude').value || 'N/A';
        const route = document.getElementById('route').value || 'N/A';
        const ete = document.getElementById('ete').value || 'N/A';
        const alternate1 = document.getElementById('alternate1').value || 'N/A';
        const alternate2 = document.getElementById('alternate2').value || 'N/A';
        const remarks = document.getElementById('remarks').value || 'N/A';

        // Validate required fields
        if (!departure || !destination || !altitude) {
            alert('Please fill in the required fields: Departure, Destination, and Altitude.');
            return;
        }

        // Add the submitted flight plan to the table
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${aircraftId}</td>
            <td>${aircraftType}</td>
            <td>${departure}</td>
            <td>${destination}</td>
            <td>${altitude}</td>
            <td>${route}</td>
            <td>${remarks}</td>
            <td><button type="button" class="delete-btn" onclick="deleteFlightPlan(this)">Delete</button></td>
        `;
        flightPlansTableBody.appendChild(row);

        // Reset form and preview
        flightPlannerForm.reset();
        updateFlightPlanPreview();
    }

    // Clear Flight Plan
    function clearFlightPlan() {
        flightPlannerForm.reset();
        updateFlightPlanPreview();
    }

    // Delete a flight plan from the table
    window.deleteFlightPlan = function (button) {
        const row = button.closest('tr');
        row.remove();
    };

    // Event Listeners
    flightPlannerForm.addEventListener('input', updateFlightPlanPreview);
    flightPlannerForm.addEventListener('submit', submitFlightPlan);
    document.querySelector('.clear-btn').addEventListener('click', clearFlightPlan);

    // Initialize Preview with Default Values
    updateFlightPlanPreview();
});
